<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Your Free Brochure</title>
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“‹</text></svg>">
    <script id="recaptcha-script" async defer></script>
    <script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #2c2c2c 0%, #1a1a1a 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="%23333" stroke-width="0.5" opacity="0.3"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            opacity: 0.1;
            z-index: -1;
        }

        .container {
            background: rgba(0, 0, 0, 0.85);
            border: 1px solid #c9a96e;
            border-radius: 8px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5), 0 0 0 1px rgba(201, 169, 110, 0.2);
            max-width: 400px;
            width: 100%;
            padding: 40px 30px;
            text-align: center;
            position: relative;
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        .container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #c9a96e, #d4b876, #c9a96e);
        }

        .logo {
            width: 80px;
            height: 80px;
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23c9a96e"/><text x="50" y="60" text-anchor="middle" fill="%23000" font-size="40" font-family="Arial">ðŸ‘¤</text></svg>');
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid #c9a96e;
            position: relative;
        }

        .logo::after {
            content: '';
            display: none;
        }

        h1 {
            color: #ffffff;
            font-size: 28px;
            margin-bottom: 10px;
            font-weight: 300;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .subtitle {
            color: #cccccc;
            font-size: 16px;
            margin-bottom: 30px;
            line-height: 1.6;
            font-weight: 300;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        label {
            display: block;
            margin-bottom: 5px;
            color: #c9a96e;
            font-weight: 400;
            font-size: 14px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        input {
            width: 100%;
            padding: 15px;
            border: 1px solid #444;
            border-radius: 4px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: #ffffff;
            font-weight: 300;
        }

        input:focus {
            outline: none;
            border-color: #c9a96e;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 10px rgba(201, 169, 110, 0.2);
        }

        input::placeholder {
            color: #888;
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #c9a96e, #d4b876);
            color: #1a1a1a;
            padding: 18px;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn:hover {
            background: linear-gradient(135deg, #d4b876, #e0c285);
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(201, 169, 110, 0.3);
        }

        .btn:active {
            transform: translateY(0);
        }

        .success-screen {
            display: none;
            text-align: center;
        }

        .success-icon {
            width: 100px;
            height: 100px;
            background: linear-gradient(135deg, #c9a96e, #d4b876);
            border-radius: 8px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            color: #1a1a1a;
        }

        .download-btn {
            background: linear-gradient(135deg, #c9a96e, #d4b876);
            color: #1a1a1a;
            margin-bottom: 20px;
        }

        .data-section {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #444;
            border-radius: 4px;
            padding: 20px;
            margin-top: 20px;
            text-align: left;
        }

        .data-title {
            font-weight: 500;
            margin-bottom: 10px;
            color: #c9a96e;
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-content {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #333;
            border-radius: 4px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            word-break: break-all;
            max-height: 120px;
            overflow-y: auto;
            color: #cccccc;
        }

        .copy-btn {
            background: #444;
            border: 1px solid #666;
            color: #cccccc;
            font-size: 12px;
            padding: 8px 12px;
            margin-top: 8px;
            width: auto;
            display: inline-block;
        }

        .copy-btn:hover {
            background: #555;
            border-color: #c9a96e;
        }

        .privacy {
            font-size: 12px;
            color: #888;
            margin-top: 20px;
            line-height: 1.4;
        }

        .captcha-container {
            margin: 20px 0;
            display: flex;
            justify-content: center;
        }

        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .popup {
            background: rgba(0, 0, 0, 0.9);
            border: 1px solid #c9a96e;
            border-radius: 8px;
            padding: 40px 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            animation: popupSlide 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        @keyframes popupSlide {
            from { 
                opacity: 0; 
                transform: scale(0.8) translateY(-20px); 
            }
            to { 
                opacity: 1; 
                transform: scale(1) translateY(0); 
            }
        }

        .popup-icon {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #c9a96e, #d4b876);
            border-radius: 8px;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            color: #1a1a1a;
        }

        .popup h2 {
            color: #ffffff;
            margin-bottom: 15px;
            font-size: 24px;
            font-weight: 300;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .popup p {
            color: #cccccc;
            margin-bottom: 20px;
            line-height: 1.6;
            font-weight: 300;
        }

        .countdown {
            font-size: 18px;
            font-weight: bold;
            color: #c9a96e;
        }

        @media (max-width: 480px) {
            .container {
                padding: 30px 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .subtitle {
                font-size: 14px;
            }
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Form Screen -->
        <div id="formScreen">
            <div class="logo"></div>
            <h1>Financial House Checklist</h1>
            <p class="subtitle">Get your comprehensive financial planning checklist to maximize cash flow, eliminate debt, protect your family, and build lasting wealth. Includes strategies for education savings, retirement planning, tax reduction, and legacy building.</p>
            
            <form id="contactForm">
                <div class="form-group">
                    <label for="firstName">First Name *</label>
                    <input type="text" id="firstName" name="firstName" required>
                </div>
                
                <div class="form-group">
                    <label for="lastName">Last Name *</label>
                    <input type="text" id="lastName" name="lastName" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address *</label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" placeholder="(403) 555-1234" maxlength="14">
                </div>
                
                <div class="form-group">
                    <label for="company">Company (Optional)</label>
                    <input type="text" id="company" name="company">
                </div>
                
                
                <button type="submit" class="btn">Get My Financial Checklist</button>
            </form>
            
            <p class="privacy">Your information is secure and will never be shared with third parties.</p>
        </div>

        <!-- Success Screen -->
        <div id="successScreen" class="success-screen">
            <div class="success-icon">ðŸ“§</div>
            <h1>Thank You!</h1>
            <p class="subtitle">Your Financial House Checklist has been sent to your email address. Check your inbox (and spam folder) for the download link.</p>
            
            <p class="privacy" style="margin-top: 20px; color: #c9a96e; font-weight: 500;">
                <strong>DEBUG MODE:</strong> Redirect temporarily disabled. Check console for EmailJS errors.
            </p>
        </div>
    </div>


    <script>
        // =====================================
        // CONFIGURATION SECTION - EDIT THESE
        // =====================================
        
        // Replace with your Google Drive shareable link
        const BROCHURE_URL = 'https://drive.google.com/open?id=1FR1VKooynjPPeKBoYO-hFbtZwECtyYUP&usp=drive_fs';
        
        // Replace with your website URL
        const REDIRECT_URL = 'https://linktr.ee/danaellison';
        
        // reCAPTCHA site keys - use test key for localhost
        const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
        const RECAPTCHA_SITE_KEY = isLocalhost 
            ? '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI' // Google's test key for localhost
            : '6LeoG4srAAAAALReejXcWRXHHAqsKSCKj3vJ-ICa'; // UPDATE THIS with your GitHub Pages key
        
        // Replace with your headshot image URL (updated with proper public sharing URL)
        const HEADSHOT_URL = 'https://drive.google.com/uc?export=view&id=10RNlG16hhAme0C-JWTjJ6jH54i6Vgc4p';
        
        // EmailJS Configuration - Replace with your actual service details
        const EMAILJS_SERVICE_ID = 'buscard_service';
        const EMAILJS_TEMPLATE_ID_VISITOR = 'template_check'; // Template for brochure to visitor
        const EMAILJS_TEMPLATE_ID_ADMIN = 'template_lead';     // Template for contact data to you
        const EMAILJS_PUBLIC_KEY = 'Rqgd3ar53ZPk9z4Nf';
        
        // Obfuscated admin email for security
        const ADMIN_EMAIL = atob('ZGFuYUBkamUuY2E=');
        
        // =====================================
        // Phone number formatting
        function formatPhoneNumber(input) {
            // Remove all non-digits
            let phoneNumber = input.replace(/\D/g, '');
            
            // Limit to 10 digits
            if (phoneNumber.length > 10) {
                phoneNumber = phoneNumber.substring(0, 10);
            }
            
            // Format as (403)-921-6700
            if (phoneNumber.length >= 6) {
                return `(${phoneNumber.substring(0, 3)})-${phoneNumber.substring(3, 6)}-${phoneNumber.substring(6)}`;
            } else if (phoneNumber.length >= 3) {
                return `(${phoneNumber.substring(0, 3)})-${phoneNumber.substring(3)}`;
            } else if (phoneNumber.length > 0) {
                return `(${phoneNumber}`;
            }
            return phoneNumber;
        }

        // Initialize EmailJS
        emailjs.init(EMAILJS_PUBLIC_KEY);

        // Form submission handler
        document.getElementById('contactForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            // Execute reCAPTCHA v3
            try {
                const token = await grecaptcha.execute(RECAPTCHA_SITE_KEY, {action: 'submit'});
                console.log('reCAPTCHA v3 token:', token);
            } catch (error) {
                console.error('reCAPTCHA failed:', error);
                alert('reCAPTCHA verification failed. Please try again.');
                return;
            }
            
            // Get form data
            const formData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                company: document.getElementById('company').value,
                timestamp: new Date().toISOString(),
                source: 'QR Code Landing Page'
            };
            
            // Send emails if EmailJS is configured
            if (EMAILJS_SERVICE_ID !== 'YOUR_EMAILJS_SERVICE_ID') {
                sendDualEmails(formData);
            }
            
            // Switch to success screen (clean version)
            document.getElementById('formScreen').style.display = 'none';
            document.getElementById('successScreen').style.display = 'block';
            document.getElementById('successScreen').classList.add('fade-in');
            
            // Start countdown to redirect - TEMPORARILY DISABLED FOR DEBUGGING
            // startRedirectCountdown();
        });

        // Send dual emails: brochure to visitor, contact data to admin
        async function sendDualEmails(formData) {
            try {
                // Email 1: Send brochure to visitor
                const visitorEmailParams = {
                    to_email: formData.email,
                    email: formData.email,        // Try multiple parameter names
                    user_email: formData.email,   // Common alternative
                    to_name: `${formData.firstName} ${formData.lastName}`,
                    name: `${formData.firstName} ${formData.lastName}`,  // Alternative
                    user_name: `${formData.firstName} ${formData.lastName}`, // Alternative  
                    brochure_url: BROCHURE_URL,
                    subject: 'Your Financial House Checklist is Ready!'
                };

                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID_VISITOR, visitorEmailParams);
                console.log('Brochure email sent successfully');

                // Email 2: Send contact data to admin
                const vcard = generateVCard(formData);
                const notionData = generateNotionData(formData);
                
                const adminEmailParams = {
                    to_email: ADMIN_EMAIL,
                    email: ADMIN_EMAIL,           // Try multiple parameter names  
                    user_email: ADMIN_EMAIL,     // Common alternative
                    contact_name: `${formData.firstName} ${formData.lastName}`,
                    contact_email: formData.email,
                    contact_phone: formData.phone,
                    contact_company: formData.company || 'Not provided',
                    vcard_data: vcard,
                    notion_data: JSON.stringify(notionData, null, 2),
                    source: formData.source,
                    timestamp: formData.timestamp,
                    subject: `New Lead: ${formData.firstName} ${formData.lastName}`
                };

                await emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID_ADMIN, adminEmailParams);
                console.log('Admin notification email sent successfully');

            } catch (error) {
                console.error('Email sending failed:', error);
                // Continue with the process even if emails fail
            }
        }

        // Start countdown and redirect to website
        function startRedirectCountdown() {
            let countdown = 5;
            const countdownElement = document.getElementById('countdown');
            if (!countdownElement) return;
            
            const countdownTimer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                
                if (countdown <= 0) {
                    clearInterval(countdownTimer);
                    window.location.href = REDIRECT_URL;
                }
            }, 1000);
        }

        // Generate vCard format for iOS
        function generateVCard(data) {
            let vcard = 'BEGIN:VCARD\n';
            vcard += 'VERSION:3.0\n';
            vcard += `FN:${data.firstName} ${data.lastName}\n`;
            vcard += `N:${data.lastName};${data.firstName};;;\n`;
            vcard += `EMAIL:${data.email}\n`;
            if (data.phone) {
                vcard += `TEL:${data.phone}\n`;
            }
            if (data.company) {
                vcard += `ORG:${data.company}\n`;
            }
            vcard += `NOTE:Added from QR landing page on ${new Date().toLocaleDateString()}\n`;
            vcard += 'END:VCARD';
            return vcard;
        }

        // Generate JSON format for Notion
        function generateNotionData(data) {
            return {
                "Name": `${data.firstName} ${data.lastName}`,
                "First Name": data.firstName,
                "Last Name": data.lastName,
                "Email": data.email,
                "Phone": data.phone || "",
                "Company": data.company || "",
                "Source": data.source,
                "Date Added": data.timestamp.split('T')[0],
                "Status": "New Lead",
                "Notes": `Contact submitted via QR code landing page on ${new Date().toLocaleDateString()}`
            };
        }



        // Convert Google Drive sharing URL to direct download/view URL
        function convertGoogleDriveUrl(shareUrl) {
            // Extract file ID from sharing URL
            const fileIdMatch = shareUrl.match(/\/file\/d\/([a-zA-Z0-9_-]+)/);
            if (fileIdMatch) {
                const fileId = fileIdMatch[1];
                // Return direct download URL
                return `https://drive.google.com/uc?export=download&id=${fileId}`;
            }
            // Fallback to original URL if pattern doesn't match
            return shareUrl;
        }

        // Initialize page elements when loaded
        window.onload = function() {
            // Load reCAPTCHA v3 script dynamically
            const recaptchaScript = document.getElementById('recaptcha-script');
            const isLocalhost = window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1';
            const recaptchaKey = isLocalhost 
                ? '6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI' // Google's test key for localhost
                : '6LeoG4srAAAAALReejXcWRXHHAqsKSCKj3vJ-ICa'; // Your production key
            
            recaptchaScript.src = `https://www.google.com/recaptcha/api.js?render=${recaptchaKey}`;
            
            // Wait for reCAPTCHA to load
            recaptchaScript.onload = function() {
                grecaptcha.ready(function() {
                    console.log('reCAPTCHA v3 ready');
                });
            };
            
            // Set headshot image
            const logoElement = document.querySelector('.logo');
            if (logoElement && HEADSHOT_URL !== 'YOUR_HEADSHOT_URL_HERE') {
                console.log('Loading headshot from:', HEADSHOT_URL);
                logoElement.style.backgroundImage = `url('${HEADSHOT_URL}')`;
                
                // Add error handling for image load
                const testImg = new Image();
                testImg.onload = function() {
                    console.log('Headshot loaded successfully');
                };
                testImg.onerror = function() {
                    console.error('Failed to load headshot image');
                    // Fallback to user icon if image fails
                    logoElement.style.backgroundImage = `url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23c9a96e"/><text x="50" y="60" text-anchor="middle" fill="%23000" font-size="40" font-family="Arial">ðŸ‘¤</text></svg>')`;
                };
                testImg.src = HEADSHOT_URL;
            }
            
            // Add phone number formatting
            const phoneInput = document.getElementById('phone');
            if (phoneInput) {
                phoneInput.addEventListener('input', function(e) {
                    const formatted = formatPhoneNumber(e.target.value);
                    e.target.value = formatted;
                });
            }
        };
    </script>
</body>
</html>